<!DOCTYPE html>
<html lang="fr" class="scroll-smooth bg-gray-900 text-gray-100">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Luxibre Alpha</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Loader animation */
    .loader {
      border-top-color: #6366f1;
      animation: spin 1s linear infinite;
      border-radius: 50%;
      border: 4px solid #4b5563;
      width: 48px;
      height: 48px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <header class="bg-gradient-to-r from-indigo-700 via-purple-700 to-pink-600 p-6 shadow-lg sticky top-0 z-20">
    <h1 class="text-3xl font-extrabold tracking-tight">Luxibre Alpha - Tableau de bord</h1>
    <p class="text-indigo-200 mt-1">Signaux boursiers et crypto en temps réel</p>
  </header>

  <main class="flex-grow max-w-7xl mx-auto p-6 space-y-6">
    
    <section class="flex justify-between items-center">
      <h2 class="text-2xl font-semibold">Signaux</h2>
      <label class="inline-flex items-center space-x-2 cursor-pointer select-none">
        <input type="checkbox" id="premiumToggle" class="form-checkbox h-5 w-5 text-indigo-500" />
        <span>Afficher uniquement Premium</span>
      </label>
    </section>

    <section id="loader" class="flex justify-center items-center py-20">
      <div class="loader"></div>
    </section>

    <section id="signalsContainer" class="hidden space-y-12">

      <!-- Sections pour Stocks, ETFs, Cryptos -->
      <div>
        <h3 class="text-xl font-bold border-b border-indigo-600 pb-2 mb-4">Actions (Stocks)</h3>
        <div id="stocks" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>

      <div>
        <h3 class="text-xl font-bold border-b border-indigo-600 pb-2 mb-4">ETF</h3>
        <div id="etfs" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>

      <div>
        <h3 class="text-xl font-bold border-b border-indigo-600 pb-2 mb-4">Cryptomonnaies</h3>
        <div id="cryptos" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>

    </section>

  </main>

  <footer class="bg-indigo-900 text-indigo-300 text-center py-4 text-sm select-none">
    &copy; 2025 Luxibre Alpha. Tous droits réservés.
  </footer>

<script>
  const signalsURL = 'data/signals.json';

  const premiumToggle = document.getElementById('premiumToggle');
  const loader = document.getElementById('loader');
  const container = document.getElementById('signalsContainer');
  const stocksDiv = document.getElementById('stocks');
  const etfsDiv = document.getElementById('etfs');
  const cryptosDiv = document.getElementById('cryptos');

  let allSignals = null;

  premiumToggle.addEventListener('change', () => {
    renderSignals(allSignals);
  });

  async function fetchSignals() {
    try {
      const res = await fetch(signalsURL + '?t=' + Date.now());
      if (!res.ok) throw new Error('Erreur réseau');
      const data = await res.json();
      allSignals = data;
      loader.classList.add('hidden');
      container.classList.remove('hidden');
      renderSignals(data);
    } catch (error) {
      loader.innerHTML = `<p class="text-red-500">Erreur lors du chargement des signaux : ${error.message}</p>`;
    }
  }

  function renderSignals(data) {
    const showPremiumOnly = premiumToggle.checked;

    function createCard(item) {
      // Card wrapper
      const card = document.createElement('div');
      card.className = "bg-gray-800 rounded-lg shadow-md p-5 flex flex-col";

      // Header
      const header = document.createElement('div');
      header.className = "flex justify-between items-center mb-2";
      const name = document.createElement('h4');
      name.className = "text-lg font-semibold truncate";
      name.textContent = item.name;
      header.appendChild(name);

      if(item.premium) {
        const premiumBadge = document.createElement('span');
        premiumBadge.className = "bg-indigo-600 text-indigo-100 text-xs px-2 py-0.5 rounded uppercase font-semibold tracking-wide select-none";
        premiumBadge.textContent = "Premium";
        header.appendChild(premiumBadge);
      }

      card.appendChild(header);

      // Price & recommendation
      const price = document.createElement('p');
      price.className = "text-xl font-bold text-indigo-400 mb-1";
      price.textContent = `Prix: $${item.price.toFixed(2)}`;
      card.appendChild(price);

      const rec = document.createElement('p');
      rec.className = `font-semibold ${
        item.recommendation === 'Acheter' ? 'text-green-400' :
        item.recommendation === 'Vendre' ? 'text-red-400' : 'text-yellow-300'
      } mb-4`;
      rec.textContent = `Recommandation : ${item.recommendation}`;
      card.appendChild(rec);

      // Last update
      const updated = document.createElement('p');
      updated.className = "text-xs text-gray-400 mb-2 italic";
      updated.textContent = "Mise à jour : " + new Date(item.updated).toLocaleString();
      card.appendChild(updated);

      // Graph canvas
      const canvas = document.createElement('canvas');
      canvas.style.maxHeight = "140px";
      canvas.style.width = "100%";
      card.appendChild(canvas);

      // Chart.js
      const ctx = canvas.getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: item.history.map((_, i) => i + 1),
          datasets: [{
            label: "Prix",
            data: item.history,
            borderColor: 'rgba(99, 102, 241, 0.8)',
            backgroundColor: 'rgba(99, 102, 241, 0.3)',
            fill: true,
            tension: 0.3,
            pointRadius: 0,
          }]
        },
        options: {
          responsive: true,
          animation: {duration: 800},
          scales: {
            x: { display: false },
            y: { beginAtZero: false }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });

      return card;
    }

    // Clear previous
    stocksDiv.innerHTML = '';
    etfsDiv.innerHTML = '';
    cryptosDiv.innerHTML = '';

    // Filter function
    const filterFn = item => !showPremiumOnly || item.premium;

    // Render stocks
    (data.stocks || []).filter(filterFn).forEach(stock => {
      stocksDiv.appendChild(createCard(stock));
    });
    // Render ETFs
    (data.etfs || []).filter(filterFn).forEach(etf => {
      etfsDiv.appendChild(createCard(etf));
    });
    // Render cryptos
    (data.cryptos || []).filter(filterFn).forEach(crypto => {
      cryptosDiv.appendChild(createCard(crypto));
    });

    // If no results
    if (
      stocksDiv.children.length === 0 &&
      etfsDiv.children.length === 0 &&
      cryptosDiv.children.length === 0
    ) {
      container.innerHTML = '<p class="text-center text-yellow-400 text-lg py-12">Aucun signal à afficher selon le filtre choisi.</p>';
    }
  }

  fetchSignals();
</script>

</body>
</html>
