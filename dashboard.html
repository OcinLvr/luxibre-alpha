<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Luxibre Alpha - Dashboard des Signaux</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeInUp 0.6s ease forwards;
      opacity: 0;
      transform: translateY(10px);
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* Scroll horizontal for mobile cards */
    .cards-container {
      overflow-x: auto;
      display: flex;
      gap: 1rem;
      padding-bottom: 1rem;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .card {
      scroll-snap-align: start;
      min-width: 320px;
      flex-shrink: 0;
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 2px 15px rgb(0 0 0 / 0.1);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgb(0 0 0 / 0.15);
    }
    /* Tabs */
    .tab-btn {
      cursor: pointer;
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      font-weight: 600;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .tab-btn.active {
      background-color: #4f46e5; /* indigo-600 */
      color: white;
    }
    .tab-btn:not(.active):hover {
      background-color: #e0e7ff; /* indigo-100 */
    }
    /* Scrollbar styling for cards container */
    .cards-container::-webkit-scrollbar {
      height: 8px;
    }
    .cards-container::-webkit-scrollbar-thumb {
      background-color: #a5b4fc; /* indigo-300 */
      border-radius: 10px;
    }
    .cards-container::-webkit-scrollbar-track {
      background-color: #f3f4f6; /* gray-100 */
      border-radius: 10px;
    }
    /* Badge indicators */
    .badge {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.15rem 0.5rem;
      border-radius: 9999px;
      color: white;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    .badge-rsi {
      background-color: #f59e0b; /* amber-500 */
    }
    .badge-macd {
      background-color: #10b981; /* emerald-500 */
    }
    .badge-bollinger {
      background-color: #3b82f6; /* blue-500 */
    }
    .badge-premium {
      background-color: #fbbf24; /* yellow-400 */
      color: #92400e;
      font-weight: 700;
    }
    /* Recommendation colors */
    .rec-acheter {
      background-color: #22c55e; /* green-500 */
      color: white;
    }
    .rec-vendre {
      background-color: #ef4444; /* red-500 */
      color: white;
    }
    .rec-conserver {
      background-color: #6b7280; /* gray-500 */
      color: white;
    }
    /* Icon styles */
    svg {
      width: 16px;
      height: 16px;
    }
    /* Search input */
    #searchInput {
      width: 100%;
      max-width: 400px;
      padding: 0.5rem 1rem;
      border: 1px solid #d1d5db; /* gray-300 */
      border-radius: 9999px;
      font-size: 1rem;
      outline-offset: 2px;
      transition: border-color 0.3s ease;
    }
    #searchInput:focus {
      border-color: #4f46e5; /* indigo-600 */
      box-shadow: 0 0 0 3px #c7d2fe; /* indigo-200 */
    }
    /* Grid on desktop */
    @media (min-width: 1024px) {
      .cards-container {
        overflow-x: visible;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 1.5rem;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">
  <header class="sticky top-0 bg-white shadow z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
      <h1 class="text-3xl font-extrabold text-indigo-700 select-none">Luxibre Alpha</h1>
      <div class="flex items-center gap-6">
        <input
          id="searchInput"
          type="search"
          placeholder="Rechercher par nom ou symbole..."
          aria-label="Recherche"
          spellcheck="false"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
        />
        <button
          id="refreshBtn"
          class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white rounded-full font-semibold transition"
          title="Rafraîchir les signaux"
          aria-label="Rafraîchir"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5" viewBox="0 0 24 24">
            <polyline points="1 4 1 10 7 10"></polyline>
            <polyline points="23 20 23 14 17 14"></polyline>
            <path d="M3.51 15a9 9 0 0114.85-3.36L23 14"></path>
            <path d="M20.49 9a9 9 0 00-14.85 3.36L1 10"></path>
          </svg>
          Rafraîchir
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 py-8">
    <nav class="flex gap-4 justify-center mb-8">
      <button class="tab-btn active" data-tab="stocks" aria-selected="true" role="tab" tabindex="0">Actions</button>
      <button class="tab-btn" data-tab="etfs" aria-selected="false" role="tab" tabindex="-1">ETFs</button>
      <button class="tab-btn" data-tab="cryptos" aria-selected="false" role="tab" tabindex="-1">Cryptomonnaies</button>
    </nav>

    <section id="stocks" role="tabpanel" aria-labelledby="tab-stocks">
      <div class="cards-container"></div>
    </section>

    <section id="etfs" role="tabpanel" aria-labelledby="tab-etfs" hidden>
      <div class="cards-container"></div>
    </section>

    <section id="cryptos" role="tabpanel" aria-labelledby="tab-cryptos" hidden>
      <div class="cards-container"></div>
    </section>
  </main>

  <footer class="text-center text-sm text-gray-500 py-6 select-none">
    Dernière mise à jour : <span id="lastUpdate">Chargement...</span>
  </footer>

  <script>
    const recIcons = {
      Acheter: `<svg fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="inline w-4 h-4"><path d="M12 19V5M5 12l7-7 7 7"/></svg>`,
      Vendre: `<svg fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="inline w-4 h-4"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>`,
      Conserver: `<svg fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" class="inline w-4 h-4"><circle cx="12" cy="12" r="10"/></svg>`
    };

    const recColors = {
      Acheter: "rec-acheter",
      Vendre: "rec-vendre",
      Conserver: "rec-conserver"
    };

    let signals = { stocks: [], etfs: [], cryptos: [] };
    let filteredSignals = { stocks: [], etfs: [], cryptos: [] };

    const tabs = document.querySelectorAll('.tab-btn');
    const sections = {
      stocks: document.getElementById('stocks'),
      etfs: document.getElementById('etfs'),
      cryptos: document.getElementById('cryptos')
    };

    const searchInput = document.getElementById('searchInput');
    const refreshBtn = document.getElementById('refreshBtn');
    const lastUpdateEl = document.getElementById('lastUpdate');

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      return d.toLocaleString('fr-FR', { dateStyle: 'short', timeStyle: 'short' });
    }

    function createBadge(text, className, icon = '') {
      return `<span class="badge ${className}" title="${text}">${icon}${text}</span>`;
    }

    function createCard(item) {
      const recClass = recColors[item.recommendation] || "rec-conserver";
      return `
        <article class="card fade-in p-5 flex flex-col justify-between">
          <header class="flex justify-between items-center mb-3">
            <h3 class="font-semibold text-lg truncate" title="${item.name}">${item.name}</h3>
            ${item.premium ? createBadge('Premium', 'badge-premium') : ''}
          </header>

          <div class="mb-4 flex items-center gap-3">
            <p class="text-2xl font-extrabold">${item.price.toFixed(2)} $</p>
            <p class="inline-flex items-center gap-1 px-3 py-1 rounded-full font-semibold ${recClass} select-none" title="Recommandation">
              ${recIcons[item.recommendation] || ''} ${item.recommendation}
            </p>
          </div>

          <div class="flex flex-wrap gap-2 text-xs text-gray-600">
            ${item.rsi ? createBadge(`RSI: ${item.rsi}`, 'badge-rsi') : ''}
            ${item.macd ? createBadge(`MACD: ${item.macd}`, 'badge-macd') : ''}
            ${item.bollinger ? createBadge(`Bollinger: ${item.bollinger}`, 'badge-bollinger') : ''}
          </div>

          <footer class="mt-4 text-xs text-gray-400 select-none">Dernière mise à jour : ${formatDate(item.updated)}</footer>
        </article>
      `;
    }

    function renderSection(type) {
      const container = sections[type].querySelector('.cards-container');
      if (!filteredSignals[type]?.length) {
        container.innerHTML = `<p class="text-gray-500 text-center py-12 select-none">Aucun signal disponible.</p>`;
        return;
      }
      container.innerHTML = filteredSignals[type].map(createCard).join('');
    }

    function renderAll() {
      Object.keys(filteredSignals).forEach(renderSection);
    }

    function filterSignals(query) {
      if (!query) {
        filteredSignals = { ...signals };
        return;
      }
      const q = query.toLowerCase();
      filteredSignals = {
        stocks: signals.stocks.filter(item => item.name.toLowerCase().includes(q) || (item.symbol && item.symbol.toLowerCase().includes(q))),
        etfs: signals.etfs.filter(item => item.name.toLowerCase().includes(q) || (item.symbol && item.symbol.toLowerCase().includes(q))),
        cryptos: signals.cryptos.filter(item => item.name.toLowerCase().includes(q) || (item.symbol && item.symbol.toLowerCase().includes(q))),
      };
    }

    async function loadSignals() {
      try {
        lastUpdateEl.textContent = "Chargement...";
        const res = await fetch('data/signals.json?' + Date.now());
        signals = await res.json();

        filteredSignals = { ...signals };

        // Mise à jour date globale (la plus récente parmi toutes)
        const allDates = [].concat(signals.stocks, signals.etfs, signals.cryptos)
          .map(i => new Date(i.updated).getTime())
          .filter(Boolean);
        const maxDate = new Date(Math.max(...allDates));
        lastUpdateEl.textContent = formatDate(maxDate);

        renderAll();
      } catch (e) {
        console.error('Erreur chargement signaux:', e);
        lastUpdateEl.textContent = "Erreur de chargement";
        Object.values(sections).forEach(sec => {
          sec.querySelector('.cards-container').innerHTML = `<p class="text-red-600 text-center py-12">Erreur lors du chargement des signaux.</p>`;
        });
      }
    }

    // Tabs logic
    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-selected', 'false');
          b.setAttribute('tabindex', '-1');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        btn.setAttribute('tabindex', '0');

        // Show/hide sections
        Object.keys(sections).forEach(key => {
          if (key === btn.dataset.tab) {
            sections[key].removeAttribute('hidden');
          } else {
            sections[key].setAttribute('hidden', '');
          }
        });
      });
    });

    // Search logic
    searchInput.addEventListener('input', e => {
      filterSignals(e.target.value);
      renderAll();
    });

    // Refresh button
    refreshBtn.addEventListener('click', () => {
      loadSignals();
    });

    // Initial load
    loadSignals();
  </script>
</body>
</html>
