<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luxibre Alpha - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  </head>
  <body class="bg-gray-100 text-gray-900">
    <div class="container mx-auto p-4">
      <h1 class="text-3xl font-bold mb-6 text-center">📊 Signaux de Marché - Luxibre Alpha</h1>

      <div class="flex flex-wrap gap-4 mb-6 justify-center">
        <button class="filter-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-type="all">Tous</button>
        <button class="filter-btn bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-type="buy">Achats</button>
        <button class="filter-btn bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600" data-type="hold">Conservation</button>
        <button class="filter-btn bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" data-type="sell">Ventes</button>
      </div>

      <div class="mb-6 flex justify-center">
        <label class="mr-2 font-medium">Trier par :</label>
        <select id="sort-select" class="border rounded px-3 py-1">
          <option value="none">Aucun</option>
          <option value="performance">Performance (30j)</option>
          <option value="name">Nom</option>
        </select>
      </div>

      <div id="signals-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <script>
      fetch('data/signals.json')
        .then(response => response.json())
        .then(data => {
          window.signals = data;
          renderSignals(data);
        });

      function renderSignals(signals) {
        const container = document.getElementById('signals-container');
        container.innerHTML = '';
        signals.forEach(signal => {
          const card = document.createElement('div');
          const isPremium = signal.premium === true;
          const blurClass = isPremium ? 'blur-sm relative' : '';
          const lockOverlay = isPremium ? `
            <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center text-white rounded-xl">
              <div class="mb-2"><i data-lucide="lock" class="w-6 h-6"></i></div>
              <p class="text-sm">Abonnez-vous pour débloquer</p>
            </div>` : '';

          card.className = `relative rounded-xl shadow p-4 bg-white ${getColor(signal.recommendation)} ${blurClass}`;

          card.innerHTML = `
            ${lockOverlay}
            <h2 class="text-xl font-semibold mb-2">${signal.name}</h2>
            <p class="mb-1">🔁 Recommandation : <strong>${signal.recommendation}</strong></p>
            <p class="mb-1">📈 Performance 30j : <strong>${signal.performance_30d ?? 'N/A'}%</strong></p>
            ${signal.forecast_1d && !isPremium ? `<p class="mb-1">🔮 Prévision 1j : <strong>${signal.forecast_1d}</strong></p>` : ''}
            ${signal.forecast_3d && !isPremium ? `<p class="mb-1">🔮 Prévision 3j : <strong>${signal.forecast_3d}</strong></p>` : ''}
            ${signal.forecast_7d && !isPremium ? `<p class="mb-1">🔮 Prévision 7j : <strong>${signal.forecast_7d}</strong></p>` : ''}
          `;

          container.appendChild(card);
        });
        lucide.createIcons();
      }

      function getColor(reco) {
        switch (reco) {
          case 'Achat': return 'border-l-4 border-green-500';
          case 'Vente': return 'border-l-4 border-red-500';
          case 'Conserver': return 'border-l-4 border-yellow-500';
          default: return '';
        }
      }

      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const type = btn.getAttribute('data-type');
          const filtered = type === 'all' ? window.signals : window.signals.filter(s => s.recommendation.toLowerCase() === type);
          renderSignals(filtered);
        });
      });

      document.getElementById('sort-select').addEventListener('change', (e) => {
        let sorted = [...window.signals];
        const value = e.target.value;
        if (value === 'performance') {
          sorted.sort((a, b) => (b.performance_30d || 0) - (a.performance_30d || 0));
        } else if (value === 'name') {
          sorted.sort((a, b) => a.name.localeCompare(b.name));
        }
        renderSignals(sorted);
      });
    </script>
  </body>
</html>
