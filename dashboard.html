<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Dashboard moderne pour Luxibre Alpha">
  <title>Luxibre Alpha - Dashboard Moderne</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@1.25.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #0f172a;
      color: #f1f5f9;
      margin: 0;
    }
    /* Header specific */
    header {
      font-weight: 700;
      font-size: 1.875rem; /* text-3xl */
      color: #22c55e; /* green-600 */
    }
    /* Additional styling for your dashboard content */
    main {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .notice {
      background: #dcfce7;
      color: #166534;
      border-left: 5px solid #22c55e;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      margin-bottom: 2rem;
      font-weight: 600;
      text-align: center;
    }
    #signalsContainer {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 2rem;
    }
    .card {
      background: #1e293b; /* secondary color */
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 20px rgba(34,197,94,0.4);
    }
    .card.blur {
      filter: blur(4px);
      pointer-events: none;
      user-select: none;
    }
    .card h3 {
      font-size: 1.4rem;
      margin: 0 0 0.8rem;
      color: #86efac; /* accent color */
    }
    .card p {
      margin: 0.3rem 0;
      font-size: 1.05rem;
      color: #e2e8f0;
    }
    .recommendation {
      margin-top: 0.8rem;
      font-weight: 700;
      color: #4ade80;
    }
    .chart-container {
      height: 200px;
      margin-top: 1rem;
      background: #0f172a;
      border-radius: 0.6rem;
    }
    .unlock-btn, .export-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: #22c55e;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      font-weight: 600;
      border-radius: 0.5rem;
      cursor: pointer;
      z-index: 2;
      transition: background 0.3s;
    }
    .unlock-btn:hover, .export-btn:hover {
      background: #16a34a;
    }
    footer {
      background: #1e293b;
      padding: 1rem;
      text-align: center;
      margin-top: 2rem;
      color: #9ca3af;
    }
    footer a {
      color: #22c55e;
      margin: 0 1rem;
      text-decoration: none;
    }
    @media (max-width: 600px) {
      header {
        font-size: 1.3rem;
        padding: 1rem;
      }
      .card {
        padding: 1rem;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- Header identique à index.html -->
  <header class="py-4 bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
      <h1 class="text-3xl font-bold text-green-600">Luxibre</h1>
      <nav class="hidden md:flex space-x-6 items-center">
        <a href="index.html" class="hover:text-green-600 font-medium">Accueil</a>
        <a href="dashboard.html" class="hover:text-green-600 font-medium">Dashboard</a>
        <a href="pricing.html" class="hover:text-green-600 font-medium">Abonnement</a>
        <button id="loginBtn" class="hover:text-green-600 font-medium">Connexion</button>
        <button id="logoutBtn" class="hover:text-green-600 font-medium hidden">Déconnexion</button>
      </nav>
      <!-- Mobile menu -->
      <div class="md:hidden">
        <button id="menuToggle" class="text-green-600 text-2xl">&#9776;</button>
      </div>
    </div>
    <div id="mobileMenu" class="md:hidden hidden px-6 pt-4 pb-2 bg-white space-y-2">
      <a href="index.html" class="block text-gray-800 hover:text-green-600">Accueil</a>
      <a href="dashboard.html" class="block text-gray-800 hover:text-green-600">Dashboard</a>
      <a href="pricing.html" class="block text-gray-800 hover:text-green-600">Abonnement</a>
      <button id="mobileLoginBtn" class="block text-left w-full text-gray-800 hover:text-green-600">Connexion</button>
      <button id="mobileLogoutBtn" class="block text-left w-full text-gray-800 hover:text-green-600 hidden">Déconnexion</button>
    </div>
  </header>

  <!-- Navigation boutons filtres -->
  <nav class="bg-gray-800 py-4 flex justify-center gap-4 sticky top-[72px] z-40">
    <button onclick="filterSignals('all')" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">Tous</button>
    <button onclick="filterSignals('achat')" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">Achat</button>
    <button onclick="filterSignals('vente')" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">Vente</button>
    <button onclick="filterSignals('conservation')" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">Conservation</button>
  </nav>

  <main>
    <div id="premiumNotice" class="notice" style="display: none;"></div>
    <div id="signalsContainer"></div>
    <section id="performanceReports">
      <h2>Rapports de Performance</h2>
      <!-- Contenu des rapports de performance -->
    </section>
    <section id="testimonials">
      <h2>Témoignages</h2>
      <!-- Contenu des témoignages -->
    </section>
  </main>

  <footer>
    <a href="/docs">Documentation</a>
    <a href="/support">Support</a>
  </footer>

  <!-- Supabase et logique auth + toggle mobile menu -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://jrgdwozxcilasllpvikh.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyZ2R3b3p4Y2lsYXNsbHB2aWtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MjQ0NTEsImV4cCI6MjA2MzQwMDQ1MX0.S2oGP2rdtq1IkW-oH5mC8omm698PdCgQJtGVLlIFj3w'
    );

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const mobileLoginBtn = document.getElementById("mobileLoginBtn");
    const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");

    // Vérifie utilisateur connecté
    const { data: { user } } = await supabase.auth.getUser();

    if (user) {
      loginBtn.classList.add("hidden");
      logoutBtn.classList.remove("hidden");
      mobileLoginBtn.classList.add("hidden");
      mobileLogoutBtn.classList.remove("hidden");
    } else {
      loginBtn.classList.remove("hidden");
      logoutBtn.classList.add("hidden");
      mobileLoginBtn.classList.remove("hidden");
      mobileLogoutBtn.classList.add("hidden");
    }

    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });

    mobileLogoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });

    loginBtn.addEventListener("click", () => {
      window.location.href = "login.html";
    });

    mobileLoginBtn.addEventListener("click", () => {
      window.location.href = "login.html";
    });

    document.getElementById("menuToggle").addEventListener("click", () => {
      document.getElementById("mobileMenu").classList.toggle("hidden");
    });

    // Gestion des signaux (exemple minimal, adapte selon ton generate-signals.js)
    let signals = [];

    async function loadSignals() {
      try {
        const response = await fetch('data/signals.json');
        signals = await response.json();
        renderSignals(signals);
      } catch (err) {
        console.error("Erreur chargement signaux :", err);
      }
    }

    function renderSignals(list) {
      const container = document.getElementById('signalsContainer');
      container.innerHTML = '';

      list.forEach(signal => {
        const card = document.createElement('div');
        card.className = 'card';

        // Si signal premium et utilisateur non connecté, floute la carte
        if(signal.premium && !user) {
          card.classList.add('blur');
          const unlockBtn = document.createElement('button');
          unlockBtn.textContent = "Débloquer";
          unlockBtn.className = 'unlock-btn';
          unlockBtn.onclick = () => window.location.href = 'pricing.html';
          card.appendChild(unlockBtn);
        }

        const title = document.createElement('h3');
        title.textContent = signal.symbol + " - " + signal.name;
        card.appendChild(title);

        const details = document.createElement('p');
        details.textContent = `Prix actuel : ${signal.price} €`;
        card.appendChild(details);

        const recom = document.createElement('p');
        recom.className = 'recommendation';
        recom.textContent = `Recommandation : ${signal.recommendation.toUpperCase()}`;
        card.appendChild(recom);

        container.appendChild(card);
      });
    }

    function filterSignals(type) {
      if(type === 'all') {
        renderSignals(signals);
      } else {
        renderSignals(signals.filter(s => s.recommendation === type));
      }
    }

    loadSignals();
  </script>
</body>
</html>
